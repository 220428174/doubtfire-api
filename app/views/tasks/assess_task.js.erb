// slowly fade in and replace the task status control
var taskStatusControlClass = ".task-" + "<%= @task.id %>" + "-status-control";
$(taskStatusControlClass).fadeOut("slow", function(){
	var taskStatusControlPartial = $("<%= j render 'tutor_projects/assessor_task_status_control', task: @task %>");
	$(this).replaceWith(taskStatusControlPartial);
	$(taskStatusControlClass).hide().fadeIn("slow");
});

var taskBarItemClass = "task-<%= @task.id %>-bar-item";
var taskBarItems = $("."+taskBarItemClass);

if (taskBarItems.length > 0) {
	var actionClassForTask 		= "<%= task_bar_item_class_for_mode(@task, @task.project.progress, :action) %>";
	var progressClassForTask 	= "<%= task_bar_item_class_for_mode(@task, @task.project.progress, :progress) %>";

	taskBarItems.attr("data-action-class", actionClassForTask);
	taskBarItems.attr("data-progress-class", progressClassForTask);

	var indicatorButtonSelectedClass = $(".task-indicator-button.active").attr("class");
	var indicator = indicatorButtonSelectedClass.split(" ")[2].split("-")[1];

	if (indicator === "action") {
		taskBarItems.attr("class", "task-progress-item" + " " + taskBarItemClass + " " + actionClassForTask);
	} else {
		taskBarItems.attr("class", "task-progress-item" + " " + taskBarItemClass + " " + progressClassForTask);
	}

	$.each(taskBarItems, function(i, taskBarItem) {
		$.each($(taskBarItem).parent().children(".task-progress-item"), function(j, projectTaskItem) {

			var currentProgressClass = $(projectTaskItem).attr("data-progress-class");

			if (/progress/.test(currentProgressClass) && /progress/.test(progressClassForTask))
			{
				$(projectTaskItem).attr("data-progress-class", progressClassForTask);

				if (indicator === "progress") {
					var taskIDClass = $(projectTaskItem).attr("class").split(" ")[1];
					$(projectTaskItem).attr("class", "task-progress-item" + " " + taskIDClass + " " + progressClassForTask);
				}
			}
		});
	});
}
