<% stylesheets 'dashboard.css' %>

<div class="page-header">
  <h1><%= @project_template.name %></h1>
</div>

<!-- Information about the current project -->
<div class="widget">
  <h2><i class="icon-book"></i>Information</h2>
  <div class="widget-content">
    <dl class="dl-horizontal">
      <dt><strong><%= ProjectTemplate.human_attribute_name(:name) %>:</strong></dt>
      <dd><%= @project_template.name %></dd>
      <dt><strong><%= ProjectTemplate.human_attribute_name(:description) %>:</strong></dt>
      <dd><%= @project_template.description %></dd>
      <dt><strong><%= ProjectTemplate.human_attribute_name(:start_date) %>:</strong></dt>
      <dd><%= @project_template.start_date.strftime("%d %B %Y") %></dd>
      <dt><strong><%= ProjectTemplate.human_attribute_name(:end_date) %>:</strong></dt>
      <dd><%= @project_template.end_date.strftime("%d %B %Y") %></dd>
    </dl>
    <hr />
    <%= link_to t('.edit', :default => t("helpers.links.edit")), edit_project_template_path(@project_template), :class => 'btn' %>
  </div>
</div>

<!-- Table of tasks for the current project -->
<div class="widget">
  <h2><i class="icon-book"></i>Tasks</h2>
  <div class="widget-content">
    <% if @task_templates.empty? %>
      <p>This project has no tasks.</p>
    <% else %>
      <table class="table table-striped">
        <thead>
          <tr>
            <th><%= TaskTemplate.human_attribute_name(:name) %></th>
            <th><%= TaskTemplate.human_attribute_name(:description) %></th>
            <th><%= TaskTemplate.human_attribute_name(:weighting) %></th>
            <th><%= TaskTemplate.human_attribute_name(:required) %></th>
            <th><%= TaskTemplate.human_attribute_name(:recommended_completion_date) %></th>
            <th><%=t '.actions', :default => t("helpers.actions") %></th>
          </tr>
        </thead>
        <tbody>
          <% @task_templates.each do |task_template| %>
            <tr>
              <td><%= link_to task_template.name, task_template_path(task_template) %></td>
              <td><%= task_template.description %></td>
              <td><%= task_template.weighting %></td>
              <td><%= "Required" if task_template.required %><%= "Optional" if not task_template.required %></td>
              <td><%= task_template.recommended_completion_date.strftime("%d %B %Y") %></td>
              <td>
                <%= link_to t('.edit', :default => t("helpers.links.edit")),
                            edit_task_template_path(task_template), :class => 'btn btn-mini' %>
                <%= link_to t('.destroy', :default => t("helpers.links.destroy")),
                            task_template_path(task_template),
                            :method => :delete,
                            :confirm => t('.confirm', :default => t("helpers.links.confirm", :default => 'Are you sure?')),
                            :class => 'btn btn-mini btn-danger' %>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    <% end %>
    <hr />
    <%= link_to "Create new task", new_project_task_path(@project_template), :class => 'btn btn-primary' %>
  </div>
</div>

<!-- Table of users for the current project -->
<div class="widget">
  <h2><i class="icon-book"></i>Users</h2>
  <div class="widget-content">
    <% if @project_users.empty? %>
      <p>This project has no tasks.</p>
    <% else %>
      <table class="table table-striped">
        <thead>
          <tr>
            <th><%= User.human_attribute_name(:email) %></th>
            <th><%= User.human_attribute_name(:first_name) %></th>
            <th><%= User.human_attribute_name(:last_name) %></th>
            <th><%= User.human_attribute_name(:sign_in_count) %></th>
            <th>System role</th>
            <th><%=t '.actions', :default => t("helpers.actions") %></th>
          </tr>
        </thead>
        <tbody>
          <% @project_users.each do |user| %>
            <tr>
              <td><%= link_to user.email, user %></td>
              <td><%= user.first_name %></td>
              <td><%= user.last_name %></td>
              <td><%= user.sign_in_count %></td>
              <td><%= user.system_role %></td>
              <td>
                <%= link_to t('.edit', :default => t("helpers.links.edit")),
                            edit_user_path(user), :class => 'btn btn-mini' %>
                <%= link_to t('.destroy', :default => t("helpers.links.destroy")),
                            user_path(user),
                            :method => :delete,
                            :confirm => t('.confirm', :default => t("helpers.links.confirm", :default => 'Are you sure?')),
                            :class => 'btn btn-mini btn-danger' %>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    <% end %>

    <%= link_to "Add users", new_user_path, :class => 'btn btn-primary' %>
  </div>
</div>

<!-- Action buttons (back, destroy) -->
<div class="widget">
  <div class="widget-content">
  <%= link_to "Back to projects list", project_templates_path, :class => 'btn' %>
  <%= link_to "Destroy project",
              project_template_path(@project_template),
              :method => 'delete',
              :confirm => t('.confirm', :default => t("helpers.links.confirm", :default => 'This project will be completely obliterated! Are you sure?')),
              :class => 'btn btn-danger' %>
  </div>
</div>
